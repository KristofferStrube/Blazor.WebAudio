@using KristofferStrube.Blazor.SVGEditor
@using KristofferStrube.Blazor.SVGEditor.ShapeEditors
@using KristofferStrube.Blazor.SVGEditor.Extensions
@inherits ShapeEditor<PannerNodeShape>

<g transform="translate(@SVGElement.SVG.Translate.x.AsString() @SVGElement.SVG.Translate.y.AsString()) scale(@SVGElement.SVG.Scale.AsString())">
    <rect @ref=ElementReference
          @onfocusin="FocusElement"
          @onfocusout="UnfocusElement"
          @onpointerdown="SelectAsync"
          @onkeyup="KeyUp"
          tabindex="@(SVGElement.IsChildElement ? -1 : 0)"
          x=@SVGElement.X.AsString()
          y=@SVGElement.Y.AsString()
          width=@SVGElement.Width.AsString()
          height=@SVGElement.Height.AsString()
          fill="@SVGElement.Fill"
          transform="rotate(@(SVGElement.Rotation.AsString()) @((SVGElement.X + SVGElement.Width / 2).AsString()) @((SVGElement.Y + SVGElement.Height / 2).AsString()))">
    </rect>
</g>
@if (SVGElement.Selected && SVGElement.SVG.EditMode is not EditMode.Add)
{
    <Anchor OnPointerDown="() => AnchorSelect(4)" Position="anchorPosition" />
}

@code {
    private (double x, double y) anchorPosition =>
        (
            x: SVGElement.X + SVGElement.Width / 2 + Math.Sin(-SVGElement.Rotation / 180 * Math.PI) * SVGElement.Height,
            y: SVGElement.Y + SVGElement.Height / 2 + Math.Cos(-SVGElement.Rotation / 180 * Math.PI) * SVGElement.Height
        );
}